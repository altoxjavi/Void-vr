<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>VOID VR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      font-family: system-ui, sans-serif;
    }
    .overlay.hidden { display: none; }
    .overlay h1 {
      font-size: 64px;
      color: #ff2d7b;
      text-shadow: 0 0 40px rgba(255,45,123,0.6);
      margin: 0 0 10px 0;
      letter-spacing: 0.3em;
    }
    .overlay p {
      color: rgba(255,255,255,0.5);
      margin-bottom: 40px;
    }
    .overlay button {
      background: linear-gradient(180deg, rgba(255,45,123,0.3), rgba(255,45,123,0.1));
      border: 2px solid rgba(255,45,123,0.6);
      color: white;
      padding: 20px 60px;
      font-size: 24px;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s;
    }
    .overlay button:hover {
      background: linear-gradient(180deg, rgba(255,45,123,0.5), rgba(255,45,123,0.2));
      box-shadow: 0 0 40px rgba(255,45,123,0.5);
      transform: scale(1.05);
    }
  </style>
</head>
<body>

<!-- Entry Overlay -->
<div class="overlay" id="overlay">
  <h1>VOID</h1>
  <p>Immersive Trance Experience</p>
  <button id="enterVR">► ENTER VR</button>
  <button id="enter2D">Start 2D</button>
</div>

<a-scene 
  id="scene"
  vr-mode-ui="enabled: false"
  renderer="antialias: true"
>
  <!-- Spiral shader sky - rotated to face forward -->
  <a-sky id="voidSky" void-spiral="intensity: 0.5" rotation="0 90 0"></a-sky>
  
  <!-- Reference geometry at eye level -->
  <a-ring position="0 1.6 -3" color="#ff2d7b" radius-inner="0.5" radius-outer="0.7" opacity="0.3"></a-ring>
  
  <!-- Camera -->
  <a-entity id="rig" position="0 1.6 0">
    <a-camera></a-camera>
  </a-entity>
</a-scene>

<script>
// ═══════════════════════════════════════════════════════════════
// VOID SPIRAL SHADER COMPONENT
// ═══════════════════════════════════════════════════════════════

AFRAME.registerShader('void-spiral-material', {
  schema: {
    time: { type: 'time', is: 'uniform' },
    intensity: { type: 'number', is: 'uniform', default: 0.5 },
    phase: { type: 'number', is: 'uniform', default: 0.0 },
    pulseHz: { type: 'number', is: 'uniform', default: 8.0 }
  },
  
  vertexShader: `
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,
  
  fragmentShader: `
    uniform float time;
    uniform float intensity;
    uniform float phase;
    uniform float pulseHz;
    varying vec2 vUv;
    
    #define PI 3.14159265359
    
    void main() {
      // Convert UV to centered coordinates
      // A-Frame sky maps UV so we adjust for spherical
      vec2 uv = vUv - 0.5;
      uv.x *= 2.0; // Adjust for sky sphere aspect
      
      float t = time * 0.001; // Convert ms to seconds
      
      // Polar coordinates
      float angle = atan(uv.y, uv.x);
      float radius = length(uv);
      
      // Multi-layer spiral
      float spiral1 = sin(angle * 4.0 - t * 2.0 + radius * 15.0);
      float spiral2 = sin(angle * 6.0 + t * 1.5 - radius * 20.0);
      float spiral3 = sin(angle * 3.0 - t * 1.0 + radius * 10.0);
      
      // Plasma waves
      float plasma = sin(uv.x * 8.0 + t) * sin(uv.y * 8.0 + t * 1.2);
      plasma += sin(radius * 12.0 - t * 3.0) * 0.5;
      
      // Combine
      float pattern = spiral1 * 0.35 + spiral2 * 0.25 + spiral3 * 0.2 + plasma * 0.2;
      pattern = pattern * 0.5 + 0.5; // Normalize
      
      // Pulse with binaural frequency
      float pulse = 0.5 + 0.5 * sin(t * pulseHz * 0.5);
      
      // Colors - VOID theme (deep purple/pink/cyan)
      vec3 bg = vec3(0.02, 0.0, 0.05);
      vec3 color1 = vec3(0.6, 0.1, 0.4);  // Magenta
      vec3 color2 = vec3(0.3, 0.0, 0.6);  // Purple
      vec3 color3 = vec3(0.0, 0.6, 0.8);  // Cyan
      vec3 glow = vec3(1.0, 0.3, 0.6);    // Pink glow
      
      // Build color
      vec3 col = bg;
      col = mix(col, color1, smoothstep(0.3, 0.6, pattern) * intensity);
      col = mix(col, color2, smoothstep(0.5, 0.8, spiral1 * 0.5 + 0.5) * intensity);
      col = mix(col, color3, smoothstep(0.6, 0.9, spiral2 * 0.5 + 0.5) * intensity * 0.5);
      
      // Central glow
      float glowAmt = exp(-radius * 3.0) * intensity;
      col += glow * glowAmt * 0.4;
      
      // Pulse accent
      col += color3 * pulse * 0.1 * intensity;
      
      // Phase color shift
      col = mix(col, col.gbr, phase * 0.3);
      
      gl_FragColor = vec4(col, 1.0);
    }
  `
});

// Component to apply the shader and animate it
AFRAME.registerComponent('void-spiral', {
  schema: {
    intensity: { type: 'number', default: 0.5 },
    running: { type: 'boolean', default: false }
  },
  
  init: function() {
    // Apply our custom shader material to the sky
    this.el.setAttribute('material', {
      shader: 'void-spiral-material',
      intensity: this.data.intensity,
      phase: 0,
      pulseHz: 8
    });
    
    this.phase = 0;
    this.intensity = this.data.intensity;
    this.targetIntensity = this.data.intensity;
    
    console.log('[VOID] Spiral shader initialized');
  },
  
  start: function() {
    this.data.running = true;
    this.targetIntensity = 1.0;
    console.log('[VOID] Started');
  },
  
  tick: function(time, delta) {
    if (!this.data.running) return;
    
    // Smoothly increase intensity
    if (this.intensity < this.targetIntensity) {
      this.intensity = Math.min(this.intensity + delta * 0.0001, this.targetIntensity);
      this.el.setAttribute('material', 'intensity', this.intensity);
    }
    
    // Slowly progress through phases
    this.phase += delta * 0.00001;
    if (this.phase > 1) this.phase = 1;
    this.el.setAttribute('material', 'phase', this.phase);
  }
});

// ═══════════════════════════════════════════════════════════════
// AUDIO ENGINE
// ═══════════════════════════════════════════════════════════════

let audioCtx, masterGain, droneL, droneR;

function initAudio() {
  if (audioCtx) return;
  
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  
  masterGain = audioCtx.createGain();
  masterGain.gain.value = 0;
  masterGain.connect(audioCtx.destination);
  
  // Left ear: 110 Hz
  droneL = audioCtx.createOscillator();
  droneL.type = 'sine';
  droneL.frequency.value = 110;
  const gainL = audioCtx.createGain();
  gainL.gain.value = 0.12;
  const panL = audioCtx.createStereoPanner();
  panL.pan.value = -1;
  droneL.connect(gainL).connect(panL).connect(masterGain);
  
  // Right ear: 118 Hz (8 Hz binaural difference = alpha/theta)
  droneR = audioCtx.createOscillator();
  droneR.type = 'sine';
  droneR.frequency.value = 118;
  const gainR = audioCtx.createGain();
  gainR.gain.value = 0.12;
  const panR = audioCtx.createStereoPanner();
  panR.pan.value = 1;
  droneR.connect(gainR).connect(panR).connect(masterGain);
  
  // Sub bass
  const sub = audioCtx.createOscillator();
  sub.type = 'sine';
  sub.frequency.value = 55;
  const subGain = audioCtx.createGain();
  subGain.gain.value = 0.08;
  sub.connect(subGain).connect(masterGain);
  
  // Start oscillators
  droneL.start();
  droneR.start();
  sub.start();
  
  // Fade in
  masterGain.gain.setTargetAtTime(0.6, audioCtx.currentTime, 3);
  
  console.log('[VOID] Audio started');
}

// ═══════════════════════════════════════════════════════════════
// MAIN LOGIC
// ═══════════════════════════════════════════════════════════════

const scene = document.getElementById('scene');
const overlay = document.getElementById('overlay');
const voidSky = document.getElementById('voidSky');

function startExperience() {
  overlay.classList.add('hidden');
  initAudio();
  
  // Start the spiral animation
  const spiral = voidSky.components['void-spiral'];
  if (spiral) spiral.start();
}

// VR Button
document.getElementById('enterVR').addEventListener('click', () => {
  startExperience();
  scene.enterVR();
});

// 2D Button  
document.getElementById('enter2D').addEventListener('click', () => {
  startExperience();
});

// Controller trigger in VR
scene.addEventListener('enter-vr', () => {
  console.log('[VOID] Entered VR');
});

scene.addEventListener('exit-vr', () => {
  console.log('[VOID] Exited VR');
});
</script>
</body>
</html>
